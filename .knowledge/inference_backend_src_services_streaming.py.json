{"is_source_file": true, "format": "Python", "description": "This file contains utility functions and classes for streaming events in a JSON Lines format, likely used for real-time data transmission over HTTP protocols via FastAPI. It defines functions to create various event payloads (sentence, evidence, score, done, error), and functions to stream these events as newline-delimited JSON, with optional heartbeats to keep connections alive. Additionally, it includes integration with FastAPI's StreamingResponse for HTTP streaming.", "external_files": ["fastapi.responses"], "external_methods": ["fastapi.responses.StreamingResponse", "time.time", "json.dumps"], "published": ["make_sentence_event", "make_evidence_event", "make_score_event", "make_done_event", "make_error_event", "ndjson_stream", "stream_chunks", "as_fastapi_streaming_response", "ndjson_error_response"], "classes": [], "methods": [{"name": "Dict[str,Any] make_sentence_event(sentence: Dict[str, Any], seq: int, progress: Optional[float] = None)", "description": "Constructs a sentence event payload with optional progress indicator, used in streaming responses.", "scope": "", "scopeKind": ""}, {"name": "Dict[str,Any] make_evidence_event(evidence: Dict[str, Any], seq: int, progress: Optional[float] = None)", "description": "Constructs an evidence event payload for streaming purposes.", "scope": "", "scopeKind": ""}, {"name": "Dict[str,Any] make_score_event(score: Dict[str, Any], seq: int, progress: Optional[float] = None)", "description": "Creates a score event payload for an evaluated claim for streaming.", "scope": "", "scopeKind": ""}, {"name": "Dict[str,Any] make_done_event(summary: Optional[Dict[str, Any]], seq: int = 0)", "description": "Creates a completion or 'done' event, indicating the end of a stream.", "scope": "", "scopeKind": ""}, {"name": "Dict[str,Any] make_error_event(message: Union[str, Dict[str, Any]], seq: int = 0)", "description": "Generates an error event payload, can include message string or dict.", "scope": "", "scopeKind": ""}, {"name": "Iterator[str] ndjson_stream( items: Iterable[Dict[str, Any]], heartbeat: bool = False, heartbeat_interval_sec: float = 10.0, time_source: Callable[[], float] = time.time, )", "description": "Generator that yields newline-delimited JSON strings from event dicts with optional heartbeats.", "scope": "", "scopeKind": ""}, {"name": "Iterable[str] stream_chunks(items: Iterable[Dict[str, Any]])", "description": "Minimal wrapper to convert iterable of dicts into newline-delimited JSON strings.", "scope": "", "scopeKind": ""}, {"name": "as_fastapi_streaming_response( items: Iterable[Dict[str, Any]], media_type: str = \"application/x-ndjson\", heartbeat: bool = True, heartbeat_interval_sec: float = 10.0, )", "description": "Builds a FastAPI StreamingResponse object configured for NDJSON event streaming, with heartbeat support.", "scope": "", "scopeKind": ""}, {"name": "ndjson_error_response(message: str, status_code: int = 200)", "description": "Creates a StreamingResponse that emits a single error event in NDJSON format.", "scope": "", "scopeKind": ""}, {"name": "Iterator[str] _gen()", "scope": "ndjson_error_response", "scopeKind": "function", "description": "unavailable"}, {"name": "Optional[str] _maybe_heartbeat(now_ts: float)", "scope": "ndjson_stream", "scopeKind": "function", "description": "unavailable"}, {"name": "str _ndjson_line(obj: Dict[str, Any])", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["json.dumps", "time.time", "fastapi.responses.StreamingResponse"], "search-terms": ["StreamingResponse", "NDJSON", "event streaming", "FastAPI", "make_score_event", "heartbeat", "event payload", "streaming response"], "state": 2, "file_id": 12, "knowledge_revision": 35, "git_revision": "37a8a9fcd698b38262db13c3e57c89d454b241b7", "revision_history": [{"26": "2344323706f66773742d860157a9ca24ebfc8b7c"}, {"35": "37a8a9fcd698b38262db13c3e57c89d454b241b7"}], "ctags": [{"_type": "tag", "name": "StreamingResponse", "path": "/home/kavia/workspace/code-generation/fact-verification-api-214258-214268/inference_backend/src/services/streaming.py", "pattern": "/^    StreamingResponse = None  # type: ignore[assignment]$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "_EVENT_DONE", "path": "/home/kavia/workspace/code-generation/fact-verification-api-214258-214268/inference_backend/src/services/streaming.py", "pattern": "/^_EVENT_DONE = \"done\"$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "_EVENT_ERROR", "path": "/home/kavia/workspace/code-generation/fact-verification-api-214258-214268/inference_backend/src/services/streaming.py", "pattern": "/^_EVENT_ERROR = \"error\"$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "_EVENT_EVIDENCE", "path": "/home/kavia/workspace/code-generation/fact-verification-api-214258-214268/inference_backend/src/services/streaming.py", "pattern": "/^_EVENT_EVIDENCE = \"evidence\"$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "_EVENT_SCORE", "path": "/home/kavia/workspace/code-generation/fact-verification-api-214258-214268/inference_backend/src/services/streaming.py", "pattern": "/^_EVENT_SCORE = \"score\"$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "_EVENT_SENTENCE", "path": "/home/kavia/workspace/code-generation/fact-verification-api-214258-214268/inference_backend/src/services/streaming.py", "pattern": "/^_EVENT_SENTENCE = \"sentence\"$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "_gen", "path": "/home/kavia/workspace/code-generation/fact-verification-api-214258-214268/inference_backend/src/services/streaming.py", "pattern": "/^    def _gen() -> Iterator[str]:$/", "file": true, "language": "Python", "typeref": "typename:Iterator[str]", "kind": "function", "signature": "()", "scope": "ndjson_error_response", "scopeKind": "function"}, {"_type": "tag", "name": "_maybe_heartbeat", "path": "/home/kavia/workspace/code-generation/fact-verification-api-214258-214268/inference_backend/src/services/streaming.py", "pattern": "/^    def _maybe_heartbeat(now_ts: float) -> Optional[str]:$/", "file": true, "language": "Python", "typeref": "typename:Optional[str]", "kind": "function", "signature": "(now_ts: float)", "scope": "ndjson_stream", "scopeKind": "function"}, {"_type": "tag", "name": "_ndjson_line", "path": "/home/kavia/workspace/code-generation/fact-verification-api-214258-214268/inference_backend/src/services/streaming.py", "pattern": "/^def _ndjson_line(obj: Dict[str, Any]) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(obj: Dict[str, Any])"}, {"_type": "tag", "name": "as_fastapi_streaming_response", "path": "/home/kavia/workspace/code-generation/fact-verification-api-214258-214268/inference_backend/src/services/streaming.py", "pattern": "/^def as_fastapi_streaming_response($/", "language": "Python", "kind": "function", "signature": "( items: Iterable[Dict[str, Any]], media_type: str = \"application/x-ndjson\", heartbeat: bool = True, heartbeat_interval_sec: float = 10.0, )"}, {"_type": "tag", "name": "make_done_event", "path": "/home/kavia/workspace/code-generation/fact-verification-api-214258-214268/inference_backend/src/services/streaming.py", "pattern": "/^def make_done_event(summary: Optional[Dict[str, Any]], seq: int = 0) -> Dict[str, Any]:$/", "language": "Python", "typeref": "typename:Dict[str,Any]", "kind": "function", "signature": "(summary: Optional[Dict[str, Any]], seq: int = 0)"}, {"_type": "tag", "name": "make_error_event", "path": "/home/kavia/workspace/code-generation/fact-verification-api-214258-214268/inference_backend/src/services/streaming.py", "pattern": "/^def make_error_event(message: Union[str, Dict[str, Any]], seq: int = 0) -> Dict[str, Any]:$/", "language": "Python", "typeref": "typename:Dict[str,Any]", "kind": "function", "signature": "(message: Union[str, Dict[str, Any]], seq: int = 0)"}, {"_type": "tag", "name": "make_evidence_event", "path": "/home/kavia/workspace/code-generation/fact-verification-api-214258-214268/inference_backend/src/services/streaming.py", "pattern": "/^def make_evidence_event(evidence: Dict[str, Any], seq: int, progress: Optional[float] = None) ->/", "language": "Python", "typeref": "typename:Dict[str,Any]", "kind": "function", "signature": "(evidence: Dict[str, Any], seq: int, progress: Optional[float] = None)"}, {"_type": "tag", "name": "make_score_event", "path": "/home/kavia/workspace/code-generation/fact-verification-api-214258-214268/inference_backend/src/services/streaming.py", "pattern": "/^def make_score_event(score: Dict[str, Any], seq: int, progress: Optional[float] = None) -> Dict[/", "language": "Python", "typeref": "typename:Dict[str,Any]", "kind": "function", "signature": "(score: Dict[str, Any], seq: int, progress: Optional[float] = None)"}, {"_type": "tag", "name": "make_sentence_event", "path": "/home/kavia/workspace/code-generation/fact-verification-api-214258-214268/inference_backend/src/services/streaming.py", "pattern": "/^def make_sentence_event(sentence: Dict[str, Any], seq: int, progress: Optional[float] = None) ->/", "language": "Python", "typeref": "typename:Dict[str,Any]", "kind": "function", "signature": "(sentence: Dict[str, Any], seq: int, progress: Optional[float] = None)"}, {"_type": "tag", "name": "ndjson_error_response", "path": "/home/kavia/workspace/code-generation/fact-verification-api-214258-214268/inference_backend/src/services/streaming.py", "pattern": "/^def ndjson_error_response(message: str, status_code: int = 200):$/", "language": "Python", "kind": "function", "signature": "(message: str, status_code: int = 200)"}, {"_type": "tag", "name": "ndjson_stream", "path": "/home/kavia/workspace/code-generation/fact-verification-api-214258-214268/inference_backend/src/services/streaming.py", "pattern": "/^def ndjson_stream($/", "language": "Python", "typeref": "typename:Iterator[str]", "kind": "function", "signature": "( items: Iterable[Dict[str, Any]], heartbeat: bool = False, heartbeat_interval_sec: float = 10.0, time_source: Callable[[], float] = time.time, )"}, {"_type": "tag", "name": "stream_chunks", "path": "/home/kavia/workspace/code-generation/fact-verification-api-214258-214268/inference_backend/src/services/streaming.py", "pattern": "/^def stream_chunks(items: Iterable[Dict[str, Any]]) -> Iterable[str]:$/", "language": "Python", "typeref": "typename:Iterable[str]", "kind": "function", "signature": "(items: Iterable[Dict[str, Any]])"}], "hash": "fe8bc2c68faf7b3af0fbcc966a2d1bf2", "format-version": 4, "code-base-name": "inference_backend", "filename": "inference_backend/src/services/streaming.py", "fields": [{"name": "StreamingResponse = None  # type: ignore[assignment]", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "_EVENT_DONE = \"done\"", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "_EVENT_ERROR = \"error\"", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "_EVENT_EVIDENCE = \"evidence\"", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "_EVENT_SCORE = \"score\"", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "_EVENT_SENTENCE = \"sentence\"", "scope": "", "scopeKind": "", "description": "unavailable"}]}